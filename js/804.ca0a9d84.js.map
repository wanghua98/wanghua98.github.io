{"version":3,"file":"js/804.ca0a9d84.js","mappings":"8hBA2EA,MAAMA,GAASC,EAAAA,EAAAA,MAETC,GAAWC,EAAAA,EAAAA,IAAI,CACnBC,GAAI,GACJC,KAAM,GACNC,OAAQ,GACRC,OAAQ,GACRC,MAAO,GACPC,aAAc,GACdC,QAAS,GACTC,SAAU,KAGNC,GAAmBT,EAAAA,EAAAA,KAAI,GACvBU,GAAsBV,EAAAA,EAAAA,IAAI,IAC1BW,GAAmBX,EAAAA,EAAAA,IAAI,WAGvBY,EAAeC,EAAAA,EAAOD,aAGtBE,EAAiBC,MAAOC,EAAKC,EAAU,CAAC,KAC5C,MAAMC,EAAeC,aAAaC,QAAQ,UAAY,GAEtD,IAAKF,EAGH,MAFAG,EAAY,OAAQ,SACpBxB,EAAOyB,KAAK,UACN,IAAIC,MAAM,OAGlB,MAAMC,QAAiBC,MAAMT,EAAK,IAC7BC,EACHS,QAAS,CACP,eAAgB,mBAChB,MAASR,KACND,EAAQS,WAKf,GAAwB,MAApBF,EAASG,OAIX,MAHAN,EAAY,cAAe,SAC3BO,IACA/B,EAAOyB,KAAK,UACN,IAAIC,MAAM,QAGlB,OAAOC,CAAQ,EAIXK,EAAgBd,MAAOC,EAAKC,EAAU,CAAC,KAC3C,MAAMC,EAAeC,aAAaC,QAAQ,UAAY,GAEtD,IAAKF,EAGH,MAFAG,EAAY,OAAQ,SACpBxB,EAAOyB,KAAK,UACN,IAAIC,MAAM,OAGlB,MAAMO,EAAiB,CACrB,eAAgB,mBAChB,cAAiB,UAAUZ,KAGvBM,QAAiBC,MAAMT,EAAK,IAC7BC,EACHS,QAAS,IACJI,KACAb,EAAQS,WAKf,GAAwB,MAApBF,EAASG,OAIX,MAHAN,EAAY,cAAe,SAC3BO,IACA/B,EAAOyB,KAAK,UACN,IAAIC,MAAM,QAGlB,GAAwB,MAApBC,EAASG,OAEX,MADAN,EAAY,eAAgB,SACtB,IAAIE,MAAM,QAGlB,OAAOC,CAAQ,EAIXI,EAAgBA,KACpBT,aAAaY,WAAW,SACxBZ,aAAaY,WAAW,YACxBZ,aAAaY,WAAW,SAAS,EAI7BC,EAAmBjB,UACvB,IACE,MAAMkB,EAAQd,aAAaC,QAAQ,UAAY,GAE/C,IAAKa,EAGH,OAFAZ,EAAY,OAAQ,cACpBa,YAAW,IAAMrC,EAAOyB,KAAK,WAAW,KAK1C,MAAME,QAAiBV,EAAe,GAAGF,iBAA6B,CACpEuB,OAAQ,QAGJC,QAAeZ,EAASa,OAE9B,IAAIb,EAASc,IAAsB,IAAhBF,EAAOG,KAkBxB,MAAM,IAAIhB,MAAMa,EAAOI,KAAO,YAjB9BzC,EAAS0C,MAAQ,CACfxC,GAAImC,EAAOM,KAAKzC,GAChBC,KAAMkC,EAAOM,KAAKxC,MAAQ,GAC1BC,OAAQiC,EAAOM,KAAKvC,QAAU,GAC9BC,OAAQgC,EAAOM,KAAKtC,QAAU,GAC9BC,MAAO+B,EAAOM,KAAKrC,OAAS,GAC5BC,aAAc8B,EAAOM,KAAKpC,cAAgB,GAC1CC,QAAS6B,EAAOM,KAAKnC,SAAW,GAChCC,SAAU,IAIZW,aAAawB,QAAQ,WAAYC,KAAKC,UAAU,IAC3C9C,EAAS0C,MACZjC,SAAU,KAKhB,CAAE,MAAOsC,GACPC,QAAQD,MAAM,YAAaA,GACtBA,EAAME,QAAQC,SAAS,QAAWH,EAAME,QAAQC,SAAS,OAC5D5B,EAAY,iBAAkB,QAElC,GAII6B,EAAiBnC,UACrB,IAEE,IAAKhB,EAAS0C,MAAMvC,KAAKiD,OACvB,MAAM,IAAI5B,MAAM,SAElB,IAAKxB,EAAS0C,MAAMtC,OAClB,MAAM,IAAIoB,MAAM,SAElB,IAAKxB,EAAS0C,MAAMrC,QAA2C,KAAjCL,EAAS0C,MAAMrC,OAAOgD,OAClD,MAAM,IAAI7B,MAAM,iBAElB,IAAKxB,EAAS0C,MAAMpC,OAAyC,KAAhCN,EAAS0C,MAAMpC,MAAM+C,OAChD,MAAM,IAAI7B,MAAM,gBAIlB,MAAM8B,EAAa,CACjBpD,GAAIF,EAAS0C,MAAMxC,GACnBC,KAAMH,EAAS0C,MAAMvC,KACrBC,OAAQJ,EAAS0C,MAAMtC,OACvBC,OAAQL,EAAS0C,MAAMrC,OACvBC,MAAON,EAAS0C,MAAMpC,MACtBC,aAAcP,EAAS0C,MAAMnC,aAC7BC,QAASR,EAAS0C,MAAMlC,SAItBR,EAAS0C,MAAMjC,WACjB6C,EAAW7C,SAAWT,EAAS0C,MAAMjC,UAIvC,MAAMgB,QAAiBK,EAAc,GAAGjB,YAAwB,CAC9DuB,OAAQ,QACRmB,KAAMV,KAAKC,UAAUQ,KAGjBjB,QAAeZ,EAASa,OAE9B,IAAIb,EAASc,IAAsB,IAAhBF,EAAOG,KAUxB,MAAM,IAAIhB,MAAMa,EAAOI,KAAO,QAVM,CACpCnB,EAAY,WAAY,WAExB,MAAMkC,EAAWX,KAAKY,MAAMrC,aAAaC,QAAQ,aAAe,MAC1DqC,EAAkB,IACnBF,KACAF,GAELlC,aAAawB,QAAQ,WAAYC,KAAKC,UAAUY,GAClD,CAGF,CAAE,MAAOX,GACPC,QAAQD,MAAM,YAAaA,GACtBA,EAAME,QAAQC,SAAS,OAAUH,EAAME,QAAQC,SAAS,OAC3D5B,EAAYyB,EAAME,QAAS,QAE/B,GAII3B,EAAcA,CAAC2B,EAASU,EAAO,aACnChD,EAAoB+B,MAAQO,EAC5BrC,EAAiB8B,MAAQiB,EACzBjD,EAAiBgC,OAAQ,EAEzBP,YAAW,KACTzB,EAAiBgC,OAAQ,CAAK,GAC7B,IAAK,E,OAIVkB,EAAAA,EAAAA,KAAU,KACR3B,GAAkB,I,4kFC7RpB,MAAM4B,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O,qBCPA,MAAM/C,EAAS,CAEbD,aAAc,qCAGhB,K","sources":["webpack://vue-demo2/./src/views/Family/User_family.vue","webpack://vue-demo2/./src/views/Family/User_family.vue?8dce","webpack://vue-demo2/./src/utils/config.js"],"sourcesContent":["<template>\r\n  <div class=\"user-family-container\">\r\n    <div class=\"header-section\">\r\n      <h2 class=\"title\">个人中心</h2>\r\n    </div>\r\n    \r\n    <form class=\"user-form\" @submit.prevent=\"updateUserInfo\">\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"name\">姓名：</label>\r\n          <input type=\"text\" id=\"name\" v-model.trim=\"formData.name\" placeholder=\"请输入姓名\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"gender\">性别：</label>\r\n          <select id=\"gender\" v-model.number=\"formData.gender\">\r\n            <option value=\"\">请选择性别</option>\r\n            <option value=\"1\">男</option>\r\n            <option value=\"2\">女</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"idCard\">身份证号：</label>\r\n          <input type=\"text\" id=\"idCard\" v-model.trim=\"formData.idCard\" \r\n                 placeholder=\"请输入18位身份证号\" maxlength=\"18\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"phone\">手机号：</label>\r\n          <input type=\"tel\" id=\"phone\" v-model.trim=\"formData.phone\" \r\n                 placeholder=\"请输入11位手机号\" maxlength=\"11\">\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-group full-width\">\r\n        <label for=\"relationship\">与老人关系：</label>\r\n        <input type=\"text\" id=\"relationship\" v-model.trim=\"formData.relationship\" \r\n               placeholder=\"例如：儿子, 女儿, 配偶\">\r\n      </div>\r\n\r\n      <div class=\"form-group full-width\">\r\n        <label for=\"address\">家庭住址：</label>\r\n        <input type=\"text\" id=\"address\" v-model.trim=\"formData.address\" \r\n               placeholder=\"请输入详细地址\" class=\"address-input\">\r\n      </div>\r\n      \r\n      <div class=\"form-group full-width\">\r\n        <label for=\"password\">修改密码：</label>\r\n        <input type=\"password\" id=\"password\" v-model.trim=\"formData.password\" \r\n               placeholder=\"输入新密码（选填）\">\r\n        <p class=\"password-hint\">若不修改密码，请留空</p>\r\n      </div>\r\n      \r\n      <div class=\"form-actions\">\r\n        <button type=\"submit\" class=\"btn-submit\">保存修改</button>\r\n      </div>\r\n    </form>\r\n    \r\n    <transition name=\"fade\">\r\n      <div v-if=\"showNotification\" :class=\"['notification', notificationType]\">\r\n        {{ notificationMessage }}\r\n      </div>\r\n    </transition>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\nimport config from '@/utils/config';\r\n\r\n\r\nconst router = useRouter();\r\n\r\nconst formData = ref({\r\n  id: '',\r\n  name: '',\r\n  gender: '',\r\n  idCard: '',\r\n  phone: '',\r\n  relationship: '',\r\n  address: '',\r\n  password: ''\r\n});\r\n\r\nconst showNotification = ref(false);\r\nconst notificationMessage = ref('');\r\nconst notificationType = ref('success');\r\n\r\n// 使用全局配置的API地址\r\nconst API_BASE_URL = config.API_BASE_URL;\r\n\r\n// 为特殊接口创建单独的fetch方法（使用token请求头）\r\nconst fetchWithToken = async (url, options = {}) => {\r\n  const currentToken = localStorage.getItem('token') || '';\r\n  \r\n  if (!currentToken) {\r\n    showMessage('请先登录', 'error');\r\n    router.push('/login');\r\n    throw new Error('未登录');\r\n  }\r\n\r\n  const response = await fetch(url, {\r\n    ...options,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'token': currentToken, // 特殊接口要求的请求头\r\n      ...options.headers\r\n    }\r\n  });\r\n\r\n  // 处理认证错误\r\n  if (response.status === 401) {\r\n    showMessage('登录已过期，请重新登录', 'error');\r\n    clearAuthData();\r\n    router.push('/login');\r\n    throw new Error('认证过期');\r\n  }\r\n\r\n  return response;\r\n};\r\n\r\n// 封装带认证的fetch请求（使用标准Authorization头）\r\nconst fetchWithAuth = async (url, options = {}) => {\r\n  const currentToken = localStorage.getItem('token') || '';\r\n  \r\n  if (!currentToken) {\r\n    showMessage('请先登录', 'error');\r\n    router.push('/login');\r\n    throw new Error('未登录');\r\n  }\r\n\r\n  const defaultHeaders = {\r\n    'Content-Type': 'application/json',\r\n    'Authorization': `Bearer ${currentToken}`\r\n  };\r\n\r\n  const response = await fetch(url, {\r\n    ...options,\r\n    headers: {\r\n      ...defaultHeaders,\r\n      ...options.headers\r\n    }\r\n  });\r\n\r\n  // 处理认证和权限错误\r\n  if (response.status === 401) {\r\n    showMessage('登录已过期，请重新登录', 'error');\r\n    clearAuthData();\r\n    router.push('/login');\r\n    throw new Error('认证过期');\r\n  }\r\n\r\n  if (response.status === 403) {\r\n    showMessage('权限不足，无法访问此资源', 'error');\r\n    throw new Error('权限不足');\r\n  }\r\n\r\n  return response;\r\n};\r\n\r\n// 清除认证数据\r\nconst clearAuthData = () => {\r\n  localStorage.removeItem('token');\r\n  localStorage.removeItem('userInfo');\r\n  localStorage.removeItem('userId');\r\n};\r\n\r\n// 获取初始用户数据\r\nconst fetchInitialData = async () => {\r\n  try {\r\n    const token = localStorage.getItem('token') || '';\r\n    \r\n    if (!token) {\r\n      showMessage('请先登录', 'error');\r\n      setTimeout(() => router.push('/login'), 2000);\r\n      return;\r\n    }\r\n\r\n    // 使用特殊fetch方法调用获取用户信息接口\r\n    const response = await fetchWithToken(`${API_BASE_URL}/user/getinfo`, {\r\n      method: 'GET'\r\n    });\r\n\r\n    const result = await response.json();\r\n\r\n    if (response.ok && result.code === 1) {\r\n      formData.value = {\r\n        id: result.data.id,\r\n        name: result.data.name || '',\r\n        gender: result.data.gender || '',\r\n        idCard: result.data.idCard || '',\r\n        phone: result.data.phone || '',\r\n        relationship: result.data.relationship || '',\r\n        address: result.data.address || '',\r\n        password: ''\r\n      };\r\n      \r\n      // 保存到本地存储\r\n      localStorage.setItem('userInfo', JSON.stringify({\r\n        ...formData.value,\r\n        password: '' // 密码不保存到本地\r\n      }));\r\n    } else {\r\n      throw new Error(result.msg || '获取用户信息失败');\r\n    }\r\n  } catch (error) {\r\n    console.error('获取用户数据错误:', error);\r\n    if (!error.message.includes('未登录') && !error.message.includes('认证')) {\r\n      showMessage('加载用户信息失败，请稍后重试', 'error');\r\n    }\r\n  }\r\n};\r\n\r\n// 更新用户信息\r\nconst updateUserInfo = async () => {\r\n  try {\r\n    // 表单验证\r\n    if (!formData.value.name.trim()) {\r\n      throw new Error('请输入姓名');\r\n    }\r\n    if (!formData.value.gender) {\r\n      throw new Error('请选择性别');\r\n    }\r\n    if (!formData.value.idCard || formData.value.idCard.length !== 18) {\r\n      throw new Error('请输入有效的18位身份证号');\r\n    }\r\n    if (!formData.value.phone || formData.value.phone.length !== 11) {\r\n      throw new Error('请输入有效的11位手机号');\r\n    }\r\n\r\n    // 准备发送数据\r\n    const dataToSend = {\r\n      id: formData.value.id,\r\n      name: formData.value.name,\r\n      gender: formData.value.gender,\r\n      idCard: formData.value.idCard,\r\n      phone: formData.value.phone,\r\n      relationship: formData.value.relationship,\r\n      address: formData.value.address\r\n    };\r\n    \r\n    // 添加密码字段（如果提供）\r\n    if (formData.value.password) {\r\n      dataToSend.password = formData.value.password;\r\n    }\r\n\r\n    // 更新接口使用标准Authorization头\r\n    const response = await fetchWithAuth(`${API_BASE_URL}/user/me`, {\r\n      method: 'PATCH',\r\n      body: JSON.stringify(dataToSend)\r\n    });\r\n\r\n    const result = await response.json();\r\n\r\n    if (response.ok && result.code === 1) {\r\n      showMessage('家属信息更新成功', 'success');\r\n      // 更新本地存储\r\n      const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');\r\n      const updatedUserInfo = {\r\n        ...userInfo,\r\n        ...dataToSend\r\n      };\r\n      localStorage.setItem('userInfo', JSON.stringify(updatedUserInfo));\r\n    } else {\r\n      throw new Error(result.msg || '更新失败');\r\n    }\r\n  } catch (error) {\r\n    console.error('更新家属用户错误:', error);\r\n    if (!error.message.includes('认证') && !error.message.includes('权限')) {\r\n      showMessage(error.message, 'error');\r\n    }\r\n  }\r\n};\r\n\r\n// 显示通知消息\r\nconst showMessage = (message, type = 'success') => {\r\n  notificationMessage.value = message;\r\n  notificationType.value = type;\r\n  showNotification.value = true;\r\n  \r\n  setTimeout(() => {\r\n    showNotification.value = false;\r\n  }, 3000);\r\n};\r\n\r\n// 组件挂载时获取初始数据\r\nonMounted(() => {\r\n  fetchInitialData();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.user-family-container {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  padding: 30px 20px;\r\n  background-color: #f9f9f9;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.header-section {\r\n  text-align: center;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.title {\r\n  color: #333;\r\n  font-size: 24px;\r\n  margin-bottom: 10px;\r\n  border-bottom: 2px solid #64b5f6;  \r\n  padding-bottom: 10px;\r\n  display: inline-block;\r\n}\r\n\r\n.user-form {\r\n  background: white;\r\n  padding: 25px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);\r\n  display: flex;  \r\n  flex-wrap: wrap;\r\n  justify-content: space-between;\r\n}\r\n\r\n.form-row {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  width: 100%;\r\n  margin: 0;\r\n  justify-content: space-between;\r\n}\r\n\r\n.form-group {\r\n  flex: 1 1 calc(50% - 20px);\r\n  min-width: 250px;\r\n  margin: 0 10px 20px;\r\n}\r\n\r\n.form-group.full-width {\r\n  flex: 1 1 100%;\r\n}\r\n\r\n.form-group label {\r\n  display: block;\r\n  margin-bottom: 8px;\r\n  font-weight: 500;\r\n  color: #555;\r\n}\r\n\r\n.form-group input,\r\n.form-group select {\r\n  width: 100%;\r\n  padding: 10px 15px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  font-size: 15px;\r\n  transition: border-color 0.3s;\r\n}\r\n\r\n.form-group input:focus,\r\n.form-group select:focus {\r\n  outline: none;\r\n  border-color: #64b5f6;\r\n  box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.2);\r\n}\r\n\r\n.form-actions {\r\n  text-align: center;\r\n  margin-top: 15px;\r\n  width: 100%;\r\n  margin-left: 10px;\r\n  margin-right: 10px;\r\n}\r\n\r\n.btn-submit {\r\n  background-color: #64b5f6;\r\n  color: white;\r\n  border: none;\r\n  padding: 12px 30px;\r\n  font-size: 16px;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s;\r\n}\r\n\r\n.btn-submit:hover {\r\n  background-color: #42a5f5;\r\n}\r\n\r\n.password-hint {\r\n  font-size: 12px;\r\n  color: #888;\r\n  margin-top: 5px;\r\n}\r\n\r\n.notification {\r\n  position: fixed;\r\n  top: 20px;\r\n  right: 20px;\r\n  padding: 12px 20px;\r\n  border-radius: 4px;\r\n  color: white;\r\n  font-weight: 500;\r\n  z-index: 1000;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.notification.success {\r\n  background-color: #4CAF50;  \r\n}\r\n\r\n.notification.error {\r\n  background-color: #f44336;\r\n}\r\n\r\n.fade-enter-active,\r\n.fade-leave-active {\r\n  transition: opacity 0.5s, transform 0.5s;\r\n}\r\n\r\n.fade-enter-from,\r\n.fade-leave-to {\r\n  opacity: 0;\r\n  transform: translateY(-30px);\r\n}\r\n</style>","import script from \"./User_family.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./User_family.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./User_family.vue?vue&type=style&index=0&id=4fdb49a4&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4fdb49a4\"]])\n\nexport default __exports__","// 全局配置文件\nconst config = {\n  // 后端API基础地址\n  API_BASE_URL: 'https://wanghua935.dpdns.org:8080'\n};\n\nexport default config;"],"names":["router","useRouter","formData","ref","id","name","gender","idCard","phone","relationship","address","password","showNotification","notificationMessage","notificationType","API_BASE_URL","config","fetchWithToken","async","url","options","currentToken","localStorage","getItem","showMessage","push","Error","response","fetch","headers","status","clearAuthData","fetchWithAuth","defaultHeaders","removeItem","fetchInitialData","token","setTimeout","method","result","json","ok","code","msg","value","data","setItem","JSON","stringify","error","console","message","includes","updateUserInfo","trim","length","dataToSend","body","userInfo","parse","updatedUserInfo","type","onMounted","__exports__"],"sourceRoot":""}