"use strict";(self["webpackChunkvue_demo2"]=self["webpackChunkvue_demo2"]||[]).push([[860],{2860:function(s,e,i){i.r(e),i.d(e,{default:function(){return x}});var t=i(6768),a=i(4232);const n={class:"dashboard"},l={class:"sidebar"},o={class:"user-profile"},c={style:{color:"var(--accent)"}},r={class:"nav-menu",style:{display:"grid",gap:"12px","margin-top":"30px"}},d={class:"main-content"},h={class:"card check-in-card"},u={class:"check-in-header"},y={style:{"font-size":"18px"}},v={id:"points"},g={class:"check-in-days"},m=["disabled"],p={key:0,style:{color:"var(--emergency)","margin-top":"10px","font-size":"14px"}},k={key:1,style:{color:"var(--secondary)","margin-top":"10px","font-size":"14px"}};function f(s,e,i,f,w,b){return(0,t.uX)(),(0,t.CE)(t.FK,null,[e[18]||(e[18]=(0,t.Lk)("div",{class:"safety-monitoring",role:"alert","aria-live":"assertive"},[(0,t.Lk)("div",{class:"safety-status","aria-label":"安全监测系统运行中"},[(0,t.Lk)("div",{class:"status-indicator"}),(0,t.Lk)("span",{id:"safetyText"},"安全监测运行正常")]),(0,t.Lk)("div",{class:"emergency-controls"},[(0,t.Lk)("button",{id:"emergencyBtn",class:"elderly-friendly",style:{background:"var(--emergency)",color:"white"}},[(0,t.Lk)("i",{class:"material-icons"},"emergency"),(0,t.eW)(" 紧急呼叫 ")]),(0,t.Lk)("button",{class:"elderly-friendly",style:{background:"var(--accent)",color:"white"}},[(0,t.Lk)("i",{class:"material-icons"},"settings"),(0,t.eW)(" 安全设置 ")])])],-1)),(0,t.Lk)("div",n,[(0,t.Lk)("nav",l,[(0,t.Lk)("div",o,[e[6]||(e[6]=(0,t.Lk)("h2",null,"张大爷，下午好！",-1)),e[7]||(e[7]=(0,t.Lk)("p",null,[(0,t.eW)("今日健康评分："),(0,t.Lk)("span",{style:{color:"var(--secondary)"}},"92")],-1)),(0,t.Lk)("p",null,[e[4]||(e[4]=(0,t.eW)("连续签到：")),(0,t.Lk)("span",c,(0,a.v_)(w.continuousDays),1),e[5]||(e[5]=(0,t.eW)(" 天"))])]),(0,t.Lk)("div",r,[e[11]||(e[11]=(0,t.Lk)("button",{class:"elderly-friendly",style:{background:"var(--primary)",color:"white"}},[(0,t.Lk)("i",{class:"material-icons"},"home"),(0,t.eW)(" 首页 ")],-1)),(0,t.Lk)("button",{class:"elderly-friendly",onClick:e[0]||(e[0]=(...s)=>b.goToAEldserve&&b.goToAEldserve(...s))},e[8]||(e[8]=[(0,t.Lk)("i",{class:"material-icons"},"medical_services",-1),(0,t.eW)(" 陪诊服务 ")])),e[12]||(e[12]=(0,t.Lk)("button",{class:"elderly-friendly"},[(0,t.Lk)("i",{class:"material-icons"},"groups"),(0,t.eW)(" 养老社交 ")],-1)),e[13]||(e[13]=(0,t.Lk)("button",{class:"elderly-friendly"},[(0,t.Lk)("i",{class:"material-icons"},"store"),(0,t.eW)(" 服务商城 ")],-1)),(0,t.Lk)("button",{class:"elderly-friendly",onClick:e[1]||(e[1]=(...s)=>b.goToElderHealthy&&b.goToElderHealthy(...s))},e[9]||(e[9]=[(0,t.Lk)("i",{class:"material-icons"},"star",-1),(0,t.eW)(" 健康管理 ")])),(0,t.Lk)("button",{class:"elderly-friendly",onClick:e[2]||(e[2]=(...s)=>b.goToUserElder&&b.goToUserElder(...s))},e[10]||(e[10]=[(0,t.Lk)("i",{class:"material-icons"},"person",-1),(0,t.eW)(" 个人中心 ")]))])]),(0,t.Lk)("main",d,[(0,t.Lk)("div",h,[(0,t.Lk)("div",u,[e[15]||(e[15]=(0,t.Lk)("h2",null,[(0,t.Lk)("i",{class:"material-icons"},"event_available"),(0,t.eW)(" 每日签到")],-1)),(0,t.Lk)("div",y,[e[14]||(e[14]=(0,t.eW)("积分: ")),(0,t.Lk)("span",v,(0,a.v_)(w.userPoints),1)])]),(0,t.Lk)("div",g,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(w.weekDays,((s,e)=>((0,t.uX)(),(0,t.CE)("div",{class:"check-in-day",key:e},[(0,t.Lk)("div",{class:(0,a.C4)(["day-circle",{today:e===w.currentDayIndex},{checked:s.checked},{"just-checked":s.justChecked}])},(0,a.v_)(s.label),3),(0,t.Lk)("small",null,(0,a.v_)(s.points),1)])))),128))]),(0,t.Lk)("button",{class:"check-in-button",onClick:e[3]||(e[3]=(...s)=>b.handleCheckIn&&b.handleCheckIn(...s)),disabled:w.hasCheckedInToday||w.isSigning},[w.showCoin?((0,t.uX)(),(0,t.CE)("div",{key:0,class:(0,a.C4)(["gold-coin",w.coinClass])},"¥",2)):(0,t.Q3)("",!0),e[16]||(e[16]=(0,t.Lk)("i",{class:"material-icons"},"how_to_reg",-1)),(0,t.eW)(" "+(0,a.v_)(w.hasCheckedInToday?"已签到":w.isSigning?"签到中...":"签到"),1)],8,m),w.signError?((0,t.uX)(),(0,t.CE)("div",p," 签到失败: "+(0,a.v_)(w.signError),1)):(0,t.Q3)("",!0),w.signSuccess?((0,t.uX)(),(0,t.CE)("div",k," 签到成功! +"+(0,a.v_)(w.earnedPoints)+"积分 (连续签到"+(0,a.v_)(w.continuousDays)+"天) ",1)):(0,t.Q3)("",!0)]),e[17]||(e[17]=(0,t.Fv)('<div class="card health-dashboard"><div class="health-item"><h3><i class="material-icons">favorite</i> 心率</h3><div class="value">78 <small>bpm</small></div></div><div class="health-item"><h3><i class="material-icons">bloodtype</i> 血压</h3><div class="value">122/78 <small>mmHg</small></div></div><div class="health-item"><h3><i class="material-icons">directions_walk</i> 步数</h3><div class="value">2,345 <small>步</small></div></div></div><div class="card"><h2><i class="material-icons">store</i> 服务商城</h2><div class="service-category"><h3><i class="material-icons">cleaning_services</i> 居家服务</h3><div class="service-list"><div class="service-item"><h4><i class="material-icons">clean_hands</i> 专业保洁</h4><p>2小时深度清洁，含厨房卫生间</p><div class="service-price">¥98/次</div><button class="service-button">立即预约</button></div></div></div><div style="text-align:center;margin-top:15px;"><button class="elderly-friendly" style="width:100%;"><i class="material-icons">search</i> 查看更多服务 </button></div></div><div class="card"><h2><i class="material-icons">medical_services</i> 快速预约</h2><div class="quick-services"><button class="elderly-friendly" style="background:var(--secondary);"><i class="material-icons">calendar_today</i> 预约挂号 </button><button class="elderly-friendly" style="background:var(--accent);"><i class="material-icons">medication</i> 用药提醒 </button><button class="elderly-friendly"><i class="material-icons">history</i> 就诊记录 </button></div></div><div class="card"><h2><i class="material-icons">groups</i> 最近聊天</h2><div class="chat-history"><div class="chat-message incoming"><div class="message-info"><img src="avatar1.jpg" class="message-avatar" alt="李阿姨"><strong>李阿姨</strong><span style="margin-left:auto;font-size:0.8em;">10:30</span></div><p>大家下午的书法活动别忘了带毛笔啊！</p></div><div class="chat-message outgoing"><div class="message-info"><strong>我</strong><span style="margin-left:auto;font-size:0.8em;">10:35</span></div><p>好的，我已经准备好了，需要我带点宣纸吗？</p></div><div class="chat-message incoming"><div class="message-info"><img src="avatar2.jpg" class="message-avatar" alt="王大爷"><strong>王大爷</strong><span style="margin-left:auto;font-size:0.8em;">11:20</span></div><p>明天上午的健康讲座改到9点半了，别记错时间</p></div><div class="chat-message incoming"><div class="message-info"><img src="avatar3.jpg" class="message-avatar" alt="社区小张"><strong>社区小张</strong><span style="margin-left:auto;font-size:0.8em;">13:45</span></div><p>张叔叔，您预约的体检报告已经出来了，有空可以来社区中心领取</p></div></div><button class="elderly-friendly" style="width:100%;"><i class="material-icons">chat</i> 进入聊天 </button></div><div class="card ai-assistant"><h2><i class="material-icons">smart_toy</i> 健康助手</h2><div class="chat-container"><div class="message ai-message"> 您好！我是您的健康助手，可以： <ul><li>查询健康数据</li><li>提醒用药时间</li><li>解答健康问题</li></ul></div><div class="input-area"><input type="text" class="elderly-friendly" style="flex:1;" placeholder="说点什么..." id="aiInput"><button class="elderly-friendly" style="background:var(--primary);" id="sendBtn"><i class="material-icons">send</i></button></div></div></div><div class="card"><h2><i class="material-icons">event</i> 今日活动</h2><div class="activity-list"><div class="activity-item" style="display:flex;align-items:center;padding:15px;border-bottom:1px solid #eee;"><div style="flex:1;"><h3>书法兴趣小组</h3><p><i class="material-icons">schedule</i> 09:00-11:00</p></div><button class="elderly-friendly" style="background:var(--accent);"> 参加 </button></div><div class="activity-item" style="display:flex;align-items:center;padding:15px;"><div style="flex:1;"><h3>社区健康讲座</h3><p><i class="material-icons">schedule</i> 14:00-16:00</p></div><button class="elderly-friendly" style="background:var(--accent);"> 参加 </button></div></div><button class="elderly-friendly" style="margin-top:15px;width:100%;"><i class="material-icons">add</i> 发起活动 </button></div><div class="card"><h2><i class="material-icons">star</i> 服务评价</h2><div style="display:flex;gap:10px;margin-bottom:15px;"><div style="flex:1;text-align:center;"><p style="font-size:24px;">4.8</p><div style="color:var(--accent);"><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star</i><i class="material-icons">star_half</i></div><p>综合评分</p></div><div style="flex:2;"><div style="display:flex;align-items:center;margin-bottom:5px;"><span style="width:80px;">王医生：</span><div style="flex:1;background:#eee;height:20px;border-radius:10px;"><div style="width:90%;background:var(--accent);height:100%;border-radius:10px;"></div></div></div></div></div><button class="elderly-friendly" style="width:100%;"><i class="material-icons">edit</i> 我要评价 </button></div>',7))])])],64)}i(4114),i(8111),i(2489),i(7588),i(1701);var w=i(9871);function b(s){const e=s.getDay(),i=s.getDate()-e+(0===e?-6:1),t=new Date(s.setDate(i)),a=new Date(s.setDate(i+6));return{start:t.toISOString().split("T")[0],end:a.toISOString().split("T")[0]}}function C(s){try{const e=new Date(s);return isNaN(e.getTime())?null:e.toISOString().split("T")[0]}catch(e){return console.warn("日期格式错误:",s),null}}var L={data(){return{userPoints:0,continuousDays:0,weekDays:[{label:"一",points:"",checked:!1,justChecked:!1},{label:"二",points:"",checked:!1,justChecked:!1},{label:"三",points:"",checked:!1,justChecked:!1},{label:"四",points:"",checked:!1,justChecked:!1},{label:"五",points:"",checked:!1,justChecked:!1},{label:"六",points:"",checked:!1,justChecked:!1},{label:"日",points:"",checked:!1,justChecked:!1}],currentDayIndex:((new Date).getDay()+6)%7,showCoin:!1,coinClass:"",hasCheckedInToday:!1,signError:"",signSuccess:!1,earnedPoints:0,isSigning:!1,signRecords:[],initialized:!1}},created(){this.initUserData()},methods:{goToUserElder(){this.$router.push("/elder/user/me")},goToAEldserve(){this.$router.push("/elder/AEldserve")},goToElderHealthy(){this.$router.push("/elder/Healthy")},async initUserData(){if(!this.initialized)try{await Promise.all([this.fetchUserPoints(),this.fetchSignRecords()]),this.updateCalendarStatus(),this.initialized=!0}catch(s){console.error("初始化用户数据出错:",s),this.signError=s.message||"初始化数据失败",setTimeout((()=>{this.signError=""}),5e3)}},async fetchUserPoints(){try{const s=localStorage.getItem("token");if(!s)throw new Error("用户未登录");const e=await fetch(`${w.A.API_BASE_URL}/sign/points`,{method:"GET",headers:{"Content-Type":"application/json",token:s}});if(!e.ok)throw new Error(`HTTP错误! 状态码: ${e.status}`);const i=await e.json();if(console.log("积分数据:",i),1!==i.code)throw new Error(i.msg||"获取积分失败");this.userPoints=i.data.points||0,this.continuousDays=i.data.continuousDays||0}catch(s){throw console.error("获取积分出错:",s),s}},async fetchSignRecords(){try{const s=localStorage.getItem("token");if(!s)throw new Error("用户未登录");const e=await fetch(`${w.A.API_BASE_URL}/sign/records`,{method:"GET",headers:{"Content-Type":"application/json",token:s}});if(!e.ok)throw new Error(`HTTP错误! 状态码: ${e.status}`);const i=await e.json();if(console.log("原始签到记录:",i),1!==i.code)throw new Error(i.msg||"获取签到记录失败");i.data&&i.data.rows&&Array.isArray(i.data.rows)?this.signRecords=i.data.rows.map((s=>({date:C(s.date),rewardPoints:s.rewardPoints}))):(console.warn("签到记录数据格式异常:",i),this.signRecords=[])}catch(s){throw console.error("获取签到记录出错:",s),s}},updateCalendarStatus(){const s=new Date;s.setHours(0,0,0,0),this.weekDays.forEach((s=>{s.checked=!1,s.points="",s.justChecked=!1})),this.hasCheckedInToday=!1;const e=b(new Date),i=new Date(e.start),t=new Date(e.end);i.setHours(0,0,0,0),t.setHours(0,0,0,0);const a=this.signRecords.filter((s=>{if(!s.date)return!1;try{const e=new Date(s.date);return e.setHours(0,0,0,0),e>=i&&e<=t}catch(e){return console.warn("Invalid date format:",s.date),!1}}));a.forEach((e=>{try{const i=new Date(e.date);i.setHours(0,0,0,0);const t=(i.getDay()+6)%7;this.weekDays[t].checked=!0,this.weekDays[t].points=`+${e.rewardPoints}`,i.getTime()===s.getTime()&&(this.hasCheckedInToday=!0)}catch(i){console.warn("Error processing check-in record:",e.date,i)}})),console.log("今日签到状态:",this.hasCheckedInToday,"本周签到记录:",a)},async handleCheckIn(){if(this.hasCheckedInToday||this.isSigning)console.log("签到被阻止：",{hasCheckedInToday:this.hasCheckedInToday,isSigning:this.isSigning});else{this.isSigning=!0,this.signError="",this.signSuccess=!1;try{const s=localStorage.getItem("token");if(!s)throw new Error("用户未登录");console.log("正在发送签到请求...");const e=await fetch(`${w.A.API_BASE_URL}/sign`,{method:"GET",headers:{"Content-Type":"application/json",token:s}});if(!e.ok)throw new Error(`HTTP错误! 状态码: ${e.status}`);const i=await e.json();if(console.log("签到响应:",i),1!==i.code)throw new Error(i.msg||"签到失败");this.hasCheckedInToday=!0,this.weekDays[this.currentDayIndex].checked=!0,this.weekDays[this.currentDayIndex].justChecked=!0,this.weekDays[this.currentDayIndex].points=`+${i.data.rewardPoints}`,this.earnedPoints=i.data.rewardPoints||0,this.continuousDays=i.data.continuousDays||0,this.userPoints=i.data.points||0,this.signSuccess=!0,this.playCoinAnimation(),await this.fetchSignRecords(),this.updateCalendarStatus(),setTimeout((()=>{this.weekDays[this.currentDayIndex].justChecked=!1}),1e3),setTimeout((()=>{this.signSuccess=!1}),5e3)}catch(s){console.error("签到出错:",s),this.signError=s.message||"签到失败",setTimeout((()=>{this.signError=""}),5e3)}finally{this.isSigning=!1}}},playCoinAnimation(){this.showCoin=!0,this.coinClass="coin-spin",setTimeout((()=>{this.coinClass="coin-spin coin-fly"}),500),setTimeout((()=>{this.showCoin=!1,this.coinClass=""}),1800)}}},T=i(1241);const E=(0,T.A)(L,[["render",f]]);var x=E},9871:function(s,e){const i={API_BASE_URL:"http://14.103.237.241:8080"};e.A=i}}]);
//# sourceMappingURL=860.5ac5587f.js.map