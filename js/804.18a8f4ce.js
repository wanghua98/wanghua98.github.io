"use strict";(self["webpackChunkvue_demo2"]=self["webpackChunkvue_demo2"]||[]).push([[804],{9804:function(e,a,o){o.r(a),o.d(a,{default:function(){return y}});o(4114);var r=o(6768),t=o(5130),s=o(4232),l=o(144),n=o(1387),d=o(9871);const i={class:"user-family-container"},u={class:"form-row"},p={class:"form-group"},c={class:"form-group"},v={class:"form-row"},m={class:"form-group"},h={class:"form-group"},f={class:"form-group full-width"},g={class:"form-group full-width"},w={class:"form-group full-width"};var k={__name:"User_family",setup(e){const a=(0,n.rd)(),o=(0,l.KR)({id:"",name:"",gender:"",idCard:"",phone:"",relationship:"",address:"",password:""}),k=(0,l.KR)(!1),L=(0,l.KR)(""),b=(0,l.KR)("success"),y=d.A.API_BASE_URL,C=async(e,o={})=>{const r=localStorage.getItem("token")||"";if(!r)throw J("请先登录","error"),a.push("/login"),new Error("未登录");const t=await fetch(e,{...o,headers:{"Content-Type":"application/json",token:r,...o.headers}});if(401===t.status)throw J("登录已过期，请重新登录","error"),E(),a.push("/login"),new Error("认证过期");return t},I=async(e,o={})=>{const r=localStorage.getItem("token")||"";if(!r)throw J("请先登录","error"),a.push("/login"),new Error("未登录");const t={"Content-Type":"application/json",Authorization:`Bearer ${r}`},s=await fetch(e,{...o,headers:{...t,...o.headers}});if(401===s.status)throw J("登录已过期，请重新登录","error"),E(),a.push("/login"),new Error("认证过期");if(403===s.status)throw J("权限不足，无法访问此资源","error"),new Error("权限不足");return s},E=()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),localStorage.removeItem("userId")},S=async()=>{try{const e=localStorage.getItem("token")||"";if(!e)return J("请先登录","error"),void setTimeout((()=>a.push("/login")),2e3);const r=await C(`${y}/user/getinfo`,{method:"GET"}),t=await r.json();if(!r.ok||1!==t.code)throw new Error(t.msg||"获取用户信息失败");o.value={id:t.data.id,name:t.data.name||"",gender:t.data.gender||"",idCard:t.data.idCard||"",phone:t.data.phone||"",relationship:t.data.relationship||"",address:t.data.address||"",password:""},localStorage.setItem("userInfo",JSON.stringify({...o.value,password:""}))}catch(e){console.error("获取用户数据错误:",e),e.message.includes("未登录")||e.message.includes("认证")||J("加载用户信息失败，请稍后重试","error")}},_=async()=>{try{if(!o.value.name.trim())throw new Error("请输入姓名");if(!o.value.gender)throw new Error("请选择性别");if(!o.value.idCard||18!==o.value.idCard.length)throw new Error("请输入有效的18位身份证号");if(!o.value.phone||11!==o.value.phone.length)throw new Error("请输入有效的11位手机号");const e={id:o.value.id,name:o.value.name,gender:o.value.gender,idCard:o.value.idCard,phone:o.value.phone,relationship:o.value.relationship,address:o.value.address};o.value.password&&(e.password=o.value.password);const a=await I(`${y}/user/me`,{method:"PATCH",body:JSON.stringify(e)}),r=await a.json();if(!a.ok||1!==r.code)throw new Error(r.msg||"更新失败");{J("家属信息更新成功","success");const a=JSON.parse(localStorage.getItem("userInfo")||"{}"),o={...a,...e};localStorage.setItem("userInfo",JSON.stringify(o))}}catch(e){console.error("更新家属用户错误:",e),e.message.includes("认证")||e.message.includes("权限")||J(e.message,"error")}},J=(e,a="success")=>{L.value=e,b.value=a,k.value=!0,setTimeout((()=>{k.value=!1}),3e3)};return(0,r.sV)((()=>{S()})),(e,a)=>((0,r.uX)(),(0,r.CE)("div",i,[a[17]||(a[17]=(0,r.Lk)("div",{class:"header-section"},[(0,r.Lk)("h2",{class:"title"},"个人中心")],-1)),(0,r.Lk)("form",{class:"user-form",onSubmit:(0,t.D$)(_,["prevent"])},[(0,r.Lk)("div",u,[(0,r.Lk)("div",p,[a[7]||(a[7]=(0,r.Lk)("label",{for:"name"},"姓名：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"name","onUpdate:modelValue":a[0]||(a[0]=e=>o.value.name=e),placeholder:"请输入姓名"},null,512),[[t.Jo,o.value.name,void 0,{trim:!0}]])]),(0,r.Lk)("div",c,[a[9]||(a[9]=(0,r.Lk)("label",{for:"gender"},"性别：",-1)),(0,r.bo)((0,r.Lk)("select",{id:"gender","onUpdate:modelValue":a[1]||(a[1]=e=>o.value.gender=e)},a[8]||(a[8]=[(0,r.Lk)("option",{value:""},"请选择性别",-1),(0,r.Lk)("option",{value:"1"},"男",-1),(0,r.Lk)("option",{value:"2"},"女",-1)]),512),[[t.u1,o.value.gender,void 0,{number:!0}]])])]),(0,r.Lk)("div",v,[(0,r.Lk)("div",m,[a[10]||(a[10]=(0,r.Lk)("label",{for:"idCard"},"身份证号：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"idCard","onUpdate:modelValue":a[2]||(a[2]=e=>o.value.idCard=e),placeholder:"请输入18位身份证号",maxlength:"18"},null,512),[[t.Jo,o.value.idCard,void 0,{trim:!0}]])]),(0,r.Lk)("div",h,[a[11]||(a[11]=(0,r.Lk)("label",{for:"phone"},"手机号：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"tel",id:"phone","onUpdate:modelValue":a[3]||(a[3]=e=>o.value.phone=e),placeholder:"请输入11位手机号",maxlength:"11"},null,512),[[t.Jo,o.value.phone,void 0,{trim:!0}]])])]),(0,r.Lk)("div",f,[a[12]||(a[12]=(0,r.Lk)("label",{for:"relationship"},"与老人关系：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"relationship","onUpdate:modelValue":a[4]||(a[4]=e=>o.value.relationship=e),placeholder:"例如：儿子, 女儿, 配偶"},null,512),[[t.Jo,o.value.relationship,void 0,{trim:!0}]])]),(0,r.Lk)("div",g,[a[13]||(a[13]=(0,r.Lk)("label",{for:"address"},"家庭住址：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"address","onUpdate:modelValue":a[5]||(a[5]=e=>o.value.address=e),placeholder:"请输入详细地址",class:"address-input"},null,512),[[t.Jo,o.value.address,void 0,{trim:!0}]])]),(0,r.Lk)("div",w,[a[14]||(a[14]=(0,r.Lk)("label",{for:"password"},"修改密码：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":a[6]||(a[6]=e=>o.value.password=e),placeholder:"输入新密码（选填）"},null,512),[[t.Jo,o.value.password,void 0,{trim:!0}]]),a[15]||(a[15]=(0,r.Lk)("p",{class:"password-hint"},"若不修改密码，请留空",-1))]),a[16]||(a[16]=(0,r.Lk)("div",{class:"form-actions"},[(0,r.Lk)("button",{type:"submit",class:"btn-submit"},"保存修改")],-1))],32),(0,r.bF)(t.eB,{name:"fade"},{default:(0,r.k6)((()=>[k.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,s.C4)(["notification",b.value])},(0,s.v_)(L.value),3)):(0,r.Q3)("",!0)])),_:1})]))}},L=o(1241);const b=(0,L.A)(k,[["__scopeId","data-v-4fdb49a4"]]);var y=b},9871:function(e,a){const o={API_BASE_URL:"http://14.103.237.241:8080"};a.A=o}}]);
//# sourceMappingURL=804.18a8f4ce.js.map