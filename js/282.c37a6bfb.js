"use strict";(self["webpackChunkvue_demo2"]=self["webpackChunkvue_demo2"]||[]).push([[282],{8282:function(e,a,o){o.r(a),o.d(a,{default:function(){return b}});o(4114);var r=o(6768),s=o(5130),n=o(4232),t=o(144),l=o(1387),d=o(9871);const u={class:"user-elder-container"},i={class:"form-row"},c={class:"form-group"},m={class:"form-group"},p={class:"form-row"},v={class:"form-group"},h={class:"form-group"},g={class:"form-group full-width"},f={class:"form-group full-width"},w={class:"form-group full-width"};var k={__name:"User_elder",setup(e){const a=(0,l.rd)(),o=(0,t.KR)(""),k=(0,t.KR)({id:"",name:"",gender:"",idCard:"",phone:"",emergencyPhone:"",address:"",password:""}),L=(0,t.KR)(!1),y=(0,t.KR)(""),b=(0,t.KR)("success"),C=d.A.API_BASE_URL,I=async(e,r={})=>{const s=localStorage.getItem("token")||o.value;if(!s)throw J("请先登录","error"),a.push("/login"),new Error("未登录");const n=await fetch(e,{...r,headers:{"Content-Type":"application/json",token:s,...r.headers}});if(401===n.status)throw J("登录已过期，请重新登录","error"),E(),a.push("/login"),new Error("认证过期");return n},S=async(e,r={})=>{const s=localStorage.getItem("token")||o.value;if(!s)throw J("请先登录","error"),a.push("/login"),new Error("未登录");const n={"Content-Type":"application/json",Authorization:`Bearer ${s}`},t=await fetch(e,{...r,headers:{...n,...r.headers}});if(401===t.status)throw J("登录已过期，请重新登录","error"),E(),a.push("/login"),new Error("认证过期");if(403===t.status)throw J("权限不足，无法访问此资源","error"),new Error("权限不足");return t},E=()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),localStorage.removeItem("userId"),o.value=""},P=async()=>{try{o.value=localStorage.getItem("token")||"";const e=JSON.parse(localStorage.getItem("userInfo")||"{}");if(!o.value)return J("请先登录","error"),void setTimeout((()=>a.push("/login")),2e3);const r=await I(`${C}/user/getinfo`,{method:"GET"}),s=await r.json();if(!r.ok||1!==s.code)throw new Error(s.msg||"获取用户信息失败");k.value={id:s.data.id,name:s.data.name||"",gender:s.data.gender||"",idCard:s.data.idCard||"",phone:s.data.phone||"",emergencyPhone:s.data.emergencyPhone||"",address:s.data.address||"",password:""},localStorage.setItem("userInfo",JSON.stringify({...e,...k.value}))}catch(e){console.error("获取用户数据错误:",e),e.message.includes("未登录")||e.message.includes("认证")||J("加载用户信息失败，请稍后重试","error")}},_=async()=>{try{if(!k.value.name.trim())throw new Error("请输入姓名");if(!k.value.gender)throw new Error("请选择性别");if(!k.value.idCard||18!==k.value.idCard.length)throw new Error("请输入有效的18位身份证号");if(!k.value.phone||11!==k.value.phone.length)throw new Error("请输入有效的11位手机号");const e={id:k.value.id,name:k.value.name,gender:k.value.gender,idCard:k.value.idCard,phone:k.value.phone,emergencyPhone:k.value.emergencyPhone,address:k.value.address};k.value.password&&(e.password=k.value.password);const a=await S(`${C}/user/me`,{method:"PATCH",body:JSON.stringify(e)}),o=await a.json();if(!a.ok||1!==o.code)throw new Error(o.msg||"更新失败");{J("用户信息更新成功","success");const e=JSON.parse(localStorage.getItem("userInfo")||"{}"),a={...e,name:k.value.name,phone:k.value.phone,emergencyPhone:k.value.emergencyPhone,address:k.value.address};localStorage.setItem("userInfo",JSON.stringify(a))}}catch(e){console.error("更新用户错误:",e),e.message.includes("认证")||e.message.includes("权限")||J(e.message,"error")}},J=(e,a="success")=>{y.value=e,b.value=a,L.value=!0,setTimeout((()=>{L.value=!1}),3e3)};return(0,r.sV)((()=>{P()})),(e,a)=>((0,r.uX)(),(0,r.CE)("div",u,[a[17]||(a[17]=(0,r.Lk)("div",{class:"header-section"},[(0,r.Lk)("h2",{class:"title"},"老人用户信息管理")],-1)),(0,r.Lk)("form",{class:"user-form",onSubmit:(0,s.D$)(_,["prevent"])},[(0,r.Lk)("div",i,[(0,r.Lk)("div",c,[a[7]||(a[7]=(0,r.Lk)("label",{for:"name"},"姓名：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"name","onUpdate:modelValue":a[0]||(a[0]=e=>k.value.name=e),placeholder:"请输入姓名"},null,512),[[s.Jo,k.value.name,void 0,{trim:!0}]])]),(0,r.Lk)("div",m,[a[9]||(a[9]=(0,r.Lk)("label",{for:"gender"},"性别：",-1)),(0,r.bo)((0,r.Lk)("select",{id:"gender","onUpdate:modelValue":a[1]||(a[1]=e=>k.value.gender=e)},a[8]||(a[8]=[(0,r.Lk)("option",{value:""},"请选择性别",-1),(0,r.Lk)("option",{value:"1"},"男",-1),(0,r.Lk)("option",{value:"2"},"女",-1)]),512),[[s.u1,k.value.gender,void 0,{number:!0}]])])]),(0,r.Lk)("div",p,[(0,r.Lk)("div",v,[a[10]||(a[10]=(0,r.Lk)("label",{for:"idCard"},"身份证号：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"idCard","onUpdate:modelValue":a[2]||(a[2]=e=>k.value.idCard=e),placeholder:"请输入18位身份证号",maxlength:"18"},null,512),[[s.Jo,k.value.idCard,void 0,{trim:!0}]])]),(0,r.Lk)("div",h,[a[11]||(a[11]=(0,r.Lk)("label",{for:"phone"},"手机号：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"tel",id:"phone","onUpdate:modelValue":a[3]||(a[3]=e=>k.value.phone=e),placeholder:"请输入11位手机号",maxlength:"11"},null,512),[[s.Jo,k.value.phone,void 0,{trim:!0}]])])]),(0,r.Lk)("div",g,[a[12]||(a[12]=(0,r.Lk)("label",{for:"emergencyPhone"},"紧急联系人电话：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"tel",id:"emergencyPhone","onUpdate:modelValue":a[4]||(a[4]=e=>k.value.emergencyPhone=e),placeholder:"请输入紧急联系人电话"},null,512),[[s.Jo,k.value.emergencyPhone,void 0,{trim:!0}]])]),(0,r.Lk)("div",f,[a[13]||(a[13]=(0,r.Lk)("label",{for:"address"},"家庭住址：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"address","onUpdate:modelValue":a[5]||(a[5]=e=>k.value.address=e),placeholder:"请输入详细地址",class:"address-input"},null,512),[[s.Jo,k.value.address,void 0,{trim:!0}]])]),(0,r.Lk)("div",w,[a[14]||(a[14]=(0,r.Lk)("label",{for:"password"},"修改密码：",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":a[6]||(a[6]=e=>k.value.password=e),placeholder:"输入新密码（选填）"},null,512),[[s.Jo,k.value.password,void 0,{trim:!0}]]),a[15]||(a[15]=(0,r.Lk)("p",{class:"password-hint"},"若不修改密码，请留空",-1))]),a[16]||(a[16]=(0,r.Lk)("div",{class:"form-actions"},[(0,r.Lk)("button",{type:"submit",class:"btn-submit"},"保存修改")],-1))],32),(0,r.bF)(s.eB,{name:"fade"},{default:(0,r.k6)((()=>[L.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,n.C4)(["notification",b.value])},(0,n.v_)(y.value),3)):(0,r.Q3)("",!0)])),_:1})]))}},L=o(1241);const y=(0,L.A)(k,[["__scopeId","data-v-49fa064c"]]);var b=y},9871:function(e,a){const o={API_BASE_URL:"https://wanghua935.dpdns.org:8080"};a.A=o}}]);
//# sourceMappingURL=282.c37a6bfb.js.map